<!DOCTYPE html>
<html>
<head>
  <title>OneSignal Player ID</title>
  <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
</head>
<body>
  <h3 id="playerId">Memuat notifikasi...</h3>

  <script>
    window.OneSignal = window.OneSignal || [];
    OneSignal.push(function() {
      OneSignal.init({
        appId: "26dac87a-7781-4f95-8e37-b5f590e1e901",
        notifyButton: { enable: true }, // tombol izinkan notifikasi
      });

      // Pantau perubahan status langganan
      OneSignal.on('subscriptionChange', function(isSubscribed) {
        if (isSubscribed) {
          OneSignal.getUserId().then(function(playerId) {
            console.log("Player ID:", playerId);
            document.getElementById("playerId").innerText = playerId;

            // Kirim playerId ke Firebase
            fetch("https://coba-31d13-default-rtdb.firebaseio.com/KeamananKendaraan/player_id.json", {
              method: "PUT",
              headers: {
                "Content-Type": "application/json"
              },
              body: JSON.stringify(playerId)
            }).then(res => {
              console.log("Terkirim ke Firebase");
            }).catch(err => {
              console.error("Gagal kirim ke Firebase:", err);
            });
          });
        } else {
          document.getElementById("playerId").innerText = "Izin notifikasi belum diberikan.";
        }
      });
    });
  </script>
</body>
</html>
